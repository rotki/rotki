<script setup lang="ts">
import type { LpType } from '@rotki/common/lib/defi';
import type { XswapPool } from '@rotki/common/lib/defi/xswap';

const props = withDefaults(
  defineProps<{
    pools: XswapPool[];
    type: LpType;
    value: string[];
    dense?: boolean;
    noPadding?: boolean;
  }>(),
  {
    dense: false,
    noPadding: false,
  },
);

const emit = defineEmits<{ (e: 'input', value: string[]): void }>();

const { value, type } = toRefs(props);
const input = (value: string[]) => emit('input', value);

const { getPoolName } = useLiquidityPosition();

function filter(item: XswapPool, queryText: string) {
  const searchString = queryText.toLocaleLowerCase();
  const name = getPoolName(get(type), item.assets).toLowerCase();
  return name.includes(searchString);
}

const { t } = useI18n();
</script>

<template>
  <RuiCard
    variant="flat"
    :no-padding="noPadding"
    rounded="sm"
    class="[&>div:last-child]:overflow-visible"
  >
    <RuiAutoComplete
      :value="value"
      :label="t('liquidity_pool_selector.label')"
      :options="pools"
      :dense="dense"
      variant="outlined"
      :filter="filter"
      clearable
      hide-details
      key-attr="address"
      chips
      hide-selected
      :item-height="44"
      @input="input($event)"
    >
      <template #selection="{ item }">
        {{ getPoolName(type, item.assets) }}
      </template>
      <template #item="{ item }">
        <div class="font-medium py-2">
          {{ getPoolName(type, item.assets) }}
        </div>
      </template>
    </RuiAutoComplete>
  </RuiCard>
</template>
