<template>
  <card full-height>
    <template #title>{{ $t('kraken_staking_received.title') }}</template>
    <template #details>
      <v-btn-toggle v-model="current" dense mandatory>
        <v-btn :value="true">
          {{ $t('kraken_staking_received.switch.current') }}
        </v-btn>
        <v-btn :value="false">
          {{ $t('kraken_staking_received.switch.historical') }}
        </v-btn>
      </v-btn-toggle>
    </template>
    <div :class="$style.received">
      <v-row
        v-for="item in received"
        :key="item.asset"
        justify="space-between"
        no-gutters
        align="center"
      >
        <v-col cols="auto">
          <asset-details :asset="item.asset" dense />
        </v-col>
        <v-col cols="auto" :class="$style.amount">
          <value-accuracy-hint v-if="!current" />
          <balance-display
            no-icon
            :asset="item.asset"
            :value="getBalance(item)"
            :price-loading="pricesAreLoading && current"
          />
        </v-col>
      </v-row>
    </div>
  </card>
</template>

<script lang="ts">
import { Balance } from '@rotki/common';
import { get } from '@vueuse/core';
import { computed, defineComponent, PropType, ref } from 'vue';
import ValueAccuracyHint from '@/components/helper/hint/ValueAccuracyHint.vue';
import { usePrices } from '@/composables/balances';
import { ReceivedAmount } from '@/types/staking';
import { Zero } from '@/utils/bignumbers';

export default defineComponent({
  name: 'KrakenStakingReceived',
  components: { ValueAccuracyHint },
  props: {
    received: {
      required: true,
      type: Array as PropType<ReceivedAmount[]>
    }
  },
  setup() {
    const { prices } = usePrices();
    const current = ref(true);
    const pricesAreLoading = computed(() => {
      return Object.keys(get(prices)).length === 0;
    });
    const getBalance = ({
      amount,
      asset,
      usdValue
    }: ReceivedAmount): Balance => {
      const assetPrices = get(prices);

      const currentPrice = assetPrices[asset]
        ? assetPrices[asset].times(amount)
        : Zero;
      return {
        amount,
        usdValue: get(current) ? currentPrice : usdValue
      };
    };
    return {
      current,
      pricesAreLoading,
      getBalance
    };
  }
});
</script>

<style lang="scss" module>
.received {
  max-height: 155px;
  overflow-y: scroll;
  overflow-x: hidden;
}

.amount {
  display: flex;
  flex-direction: row;
  flex-shrink: 1;
  align-items: center;
}
</style>
